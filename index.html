<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>IRIS Access Terminal</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #0f0;
      font-family: "Courier New", monospace;
      height: 100%;
      overflow: hidden;
    }

    #terminal {
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: rgba(0, 0, 0, 0.95);
      position: relative;
    }

    #terminal::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background: repeating-linear-gradient(
        rgba(0, 0, 0, 0) 0px,
        rgba(0, 0, 0, 0) 2px,
        rgba(0, 255, 0, 0.03) 3px
      );
      mix-blend-mode: overlay;
    }

    #terminal-text {
      flex: 1;
      white-space: pre-wrap;
      word-wrap: break-word;
      padding: 18px 22px;
      overflow-y: auto;
      box-sizing: border-box;
      line-height: 1.35;
      font-size: 15px;
    }

    #user-input {
      width: 100%;
      background: transparent;
      border: none;
      outline: none;
      color: #0f0;
      font-family: inherit;
      font-size: 16px;
      padding: 14px 20px;
      box-sizing: border-box;
      caret-color: #0f0;
      border-top: 1px solid rgba(0,255,0,0.06);
    }

    .cursor::after {
      content: "_";
      animation: blink 1s infinite step-start;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    .highlight-purple {
      color: #b300ff;
      font-weight: bold;
      text-transform: uppercase;
    }

    .highlight-gold {
      color: gold;
      font-weight: bold;
      text-transform: uppercase;
    }

    .error {
      color: #f55;
      font-weight: bold;
    }

    .muted { color: #3f6; }

  </style>
</head>
<body>
  <div id="terminal">
    <pre id="terminal-text" class="cursor" aria-live="polite"></pre>
    <input type="text" id="user-input" placeholder="Digite seu nome..." autocomplete="off" autocapitalize="off" autocorrect="off">
  </div>

<script>
(async function(){
  const terminalText = document.getElementById("terminal-text");
  const userInput = document.getElementById("user-input");

  let step = -1;
  let username = "";
  let typing = false;

  const beep = new Audio("beep.mp3");
  beep.volume = 0.16;

  const crashSound = new Audio("him.mp3");

  async function typeText(text, delay = 28) {
    typing = true;
    for (let i = 0; i < text.length; i++) {
      terminalText.textContent += text[i];
      terminalText.scrollTop = terminalText.scrollHeight;
      if (text[i] !== " " && text[i] !== "\n") {
        try { beep.currentTime = 0; beep.play(); } catch(e) {}
      }
      await new Promise(r => setTimeout(r, delay));
    }
    typing = false;
  }

  function appendHTMLLine(html) {
    terminalText.innerHTML += html;
    terminalText.scrollTop = terminalText.scrollHeight;
  }

  async function bootSequence(){
    await typeText("INICIALIZANDO SISTEMA...\n", 35);
    await new Promise(r => setTimeout(r, 450));
    await typeText("CARREGANDO ARQUIVOS [OK]\n", 28);
    await new Promise(r => setTimeout(r, 380));
    await typeText("ESTABELECENDO CONEXÃO COM O NÚCLEO IRIS [OK]\n", 28);
    await new Promise(r => setTimeout(r, 450));
    await typeText("TERMINAL PRONTO.\n\n", 28);
    await typeText("IRIS Secure Terminal v1.0\n", 24);
    await typeText("Acesso restrito. Digite seu nome de usuário:\n", 22);
    step = 0;
    userInput.focus();
  }

  function highlightWordHTML(word) {
    const lower = word.toLowerCase();
    if (lower === "transcrever" || lower === "overwrite") {
      return `<span class="highlight-purple">${escapeHtml(word).toUpperCase()}</span>`;
    }
    if (lower === "reset" || lower === "determinação" || lower === "determinacao") {
      return `<span class="highlight-gold">${escapeHtml(word).toUpperCase()}</span>`;
    }
    return escapeHtml(word);
  }

  function escapeHtml(s){
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  async function abruptCrash() {
    try {
      crashSound.play('him.mp3').catch(()=>{});
    } catch(e){}
    setTimeout(() => { 
      location.href = 'Missing.html';
    }, 500);
  }

  userInput.addEventListener("keydown", async (ev) => {
    if (ev.key !== "Enter" || typing) return;
    const raw = userInput.value || "";
    let value = raw.trim();
    userInput.value = "";
    if (!value) return;

  
    if (value.toLowerCase() === "dru") {
      const eco = `\n&gt; ${highlightWordHTML(value)}\n`;
      appendHTMLLine(eco);
      abruptCrash();
      return;
    }

    const tokens = value.split(/\s+/);
    const htmlTokens = tokens.map(t => highlightWordHTML(t)).join(' ');
    appendHTMLLine(`\n&gt; ${htmlTokens}\n`);

    if (step === 0) {
      if (value === "THUrbi") {
        username = value;
        await typeText("\nUsuário aceito.\nDigite a senha:\n", 22);
        step = 1;
      } else {
        await typeText("\nACESSO NEGADO \n", 18);
      }
    } else if (step === 1) {
      const pw = value.toUpperCase();
      const passwords = ["RESET", "LIBERDADE", "TRANSCREVER"];
      if (passwords.includes(pw)) {
        await typeText(`\nAcesso concedido. Bem-vindo, ${username}.\n`, 22);
        setTimeout(() => { window.location.href = "iris.html"; }, 1200);
      } else {
        await typeText("\nSenha incorreta. Sistema bloqueado.\n", 20);
      }
    }
  });

  bootSequence();
  document.getElementById('terminal').addEventListener('click', ()=> userInput.focus());
})();
</script>
</body>
</html>
